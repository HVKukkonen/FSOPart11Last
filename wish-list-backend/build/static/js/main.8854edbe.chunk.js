(this["webpackJsonpwish-list-frontend"]=this["webpackJsonpwish-list-frontend"]||[]).push([[0],{153:function(e,t,n){},160:function(e,t){},162:function(e,t){},173:function(e,t){},175:function(e,t){},200:function(e,t){},202:function(e,t){},203:function(e,t){},208:function(e,t){},210:function(e,t){},229:function(e,t){},241:function(e,t){},244:function(e,t){},253:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n(128),s=n.n(a),c=n(13),i=n.n(c),o=n(24),u=n(8),l=n(1),d=n(4),j=n(130),b=n(10),h=n.n(b),f="/api/wishes";var O=function(e){return h.a.get("".concat(f,"/").concat(e))},p=function(e){return h.a.post(f,e)},x=function(e,t){return h.a.put("".concat(f,"/").concat(e),t)},m=function(e){return h.a.delete("".concat(f,"/").concat(e))},w=n(75);function v(e){w.error("following error occured",e.message),"username"===e.response.data.keyword&&window.alert("Username not unique"),"invite"===e.response.data.keyword&&window.alert("Invalid invite")}var g="/api/users";var k=function(){return h.a.get(g).then((function(e){return e.data}))},y=function(e){return h.a.post(g,e).catch((function(e){v(e)}))},S=function(e,t){return h.a.put("".concat(g,"/").concat(e),t).then((function(e){return e.data}))},H=function(e){return h.a.delete("".concat(g,"/").concat(e))},N=function(e){return h.a.get("".concat(g,"/").concat(e)).then((function(e){return e.data})).catch((function(e){return v(e)}))},C=n(75);var I=function(e){return h.a.post("/api/login",e).catch((function(e){return t=e,C.error("following error occured",t.message),"admin"===t.response.data.keyword&&window.alert("Admin secret is incorrect"),void("password"===t.response.data.keyword&&window.alert("Incorrect username or password"));var t}))},A=(n(153),n(154),n(155)),T=n(247),E=function(e){return Object(r.jsxs)("form",{onSubmit:e.addWish,children:[Object(r.jsxs)("div",{children:[Object(r.jsxs)("div",{children:[Object(r.jsx)("h2",{className:"other-title",children:"Add wish"}),"description",Object(r.jsx)("br",{}),Object(r.jsx)("textarea",{className:"wish-description",value:e.descriptionHolder,onChange:e.descriptionHandler})]}),Object(r.jsxs)("div",{children:["url",Object(r.jsx)("br",{}),Object(r.jsx)("input",{className:"wish-url",value:e.urlHolder,onChange:e.urlHandler})]})]}),Object(r.jsx)("div",{children:Object(r.jsx)("button",{type:"submit",children:"Add"})})]})},J=function(e){return Object(r.jsxs)("form",{onSubmit:e.loginFormAction,children:["username:","\xa0",Object(r.jsx)("input",{value:e.usernameHolder,onChange:e.usernameHandler}),Object(r.jsx)("br",{}),"password:","\xa0",Object(r.jsx)("input",{value:e.passwordHolder,onChange:e.passwordHandler}),Object(r.jsx)("br",{}),"invite:","\xa0",Object(r.jsx)("input",{value:e.inviteHolder,onChange:e.inviteHandler,placeholder:"if wisher leave empty"}),Object(r.jsx)("br",{}),Object(r.jsx)("button",{type:"submit",children:"Submit"})]})},L=function(e){return Object(r.jsxs)("form",{onSubmit:e.loginFormAction,children:["username:","\xa0",Object(r.jsx)("input",{value:e.usernameHolder,onChange:e.usernameHandler}),Object(r.jsx)("br",{}),"password:","\xa0",Object(r.jsx)("input",{value:e.passwordHolder,onChange:e.passwordHandler}),Object(r.jsx)("br",{}),Object(r.jsx)("button",{type:"submit",children:"Submit"})]})},U=function(e,t,n,r,a,s,c,i){return{key:i,id:i,username:e,password:t,role:n,style:a,linkedUsers:r,invitePass:s,wish:c}},D=function(e){return Object(r.jsx)("div",{className:"display",children:e.text})},F=function(e,t,n,a,s){var c;return 1===e.taken&&e.taker!==s.id||(c=Object(r.jsx)("button",{onClick:function(){return t(e.id)},children:n})),Object(r.jsxs)("tr",{className:1===e.taken&&1!==s.role?"taken-row":"untaken-row",children:[Object(r.jsx)("td",{onMouseOver:function(){return a(e.description)},children:e.description}),Object(r.jsx)("td",{className:"url",children:Object(r.jsx)("a",{href:e.url,target:"_blank",children:e.url})}),Object(r.jsx)("td",{children:c})]})},P=function(e){return Object(r.jsx)("button",{onClick:function(){return window.localStorage.clear(),void e({})},children:"Log out"})},W=function(e){return Object(r.jsx)("button",{onClick:function(){e({})},children:"Admin"})},q=function(e,t){return Object(r.jsx)("button",{onClick:function(){return t()},children:e?"save":"edit"})},R=function(){var e=/[^A-Za-z0-9/]/,t=Object(l.useState)(""),n=Object(u.a)(t,2),a=n[0],s=n[1],c=function(t){t.target.value.search(e)>=0?window.alert("Input contains illegal symbols. Only characters and numbers allowed."):s(t.target.value)},b=Object(l.useState)(""),h=Object(u.a)(b,2),f=h[0],w=h[1],v=function(t){t.target.value.search(e)>=0?window.alert("Input contains illegal symbols. Only characters, numbers, and slashes allowed."):w(t.target.value)},g=Object(l.useState)(""),C=Object(u.a)(g,2),R=C[0],G=C[1],Y=function(t){t.target.value.search(e)>=0?window.alert("Input contains illegal symbols. Only characters and numbers allowed."):G(t.target.value)},z=Object(l.useState)(1),B=Object(u.a)(z,2),M=B[0],Z=B[1],_=function(){var e=Object(o.a)(i.a.mark((function e(t){var n,r,s,c,o,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),!(f.length<1||a.length<1)){e.next=4;break}return window.alert("Please, provide username and password"),e.abrupt("return");case 4:if(r={title:"Christmas Wish List"},!R){e.next=42;break}if("admin"!==a){e.next=18;break}return e.next=9,I({adminSecret:R});case 9:if(!e.sent){e.next=16;break}return e.next=12,y(U(a,f,0));case 12:(n=e.sent)&&Z(1),e.next=17;break;case 16:window.alert("admin is not allowed as a username");case 17:return e.abrupt("return");case 18:e.prev=18,s=R.split("/"),e.next=26;break;case 22:return e.prev=22,e.t0=e.catch(18),window.alert("Invite not in correct format"),e.abrupt("return");case 26:if(2===s.length){e.next=29;break}return window.alert("Invite not in correct format"),e.abrupt("return");case 29:return c=s[1],e.next=32,N(c);case 32:if(!(o=e.sent)||!A.compare(s[0],o.invitePass)){e.next=39;break}return e.next=36,y(U(a,f,2,c));case 36:n=e.sent,e.next=40;break;case 39:window.alert("error: invalid invite");case 40:e.next=46;break;case 42:return u=T.generate(),e.next=45,y(U(a,f,1,null,r,u));case 45:n=e.sent;case 46:n&&Z(1);case 47:case"end":return e.stop()}}),e,null,[[18,22]])})));return function(t){return e.apply(this,arguments)}}(),K=Object(l.useState)({}),Q=Object(u.a)(K,2),V=Q[0],X=Q[1],$=Object(l.useState)(""),ee=Object(u.a)($,2),te=(ee[0],ee[1]);Object(l.useEffect)((function(){var e=window.localStorage.getItem("user"),t=window.localStorage.getItem("token");e&&(X(JSON.parse(e)),te(JSON.parse(t)))}),[]);var ne=function(){var e=Object(o.a)(i.a.mark((function e(t){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),n={username:a,password:f},e.next=4,I(n);case 4:(r=e.sent)&&(X(r.data.user),te(r.data.token),window.localStorage.setItem("user",JSON.stringify(r.data.user)),window.localStorage.setItem("token",JSON.stringify(r.data.user)),s(""),w(""));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),re=Object(l.useState)({}),ae=Object(u.a)(re,2),se=ae[0],ce=ae[1],ie=function(){var e=Object(o.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=ce,e.next=3,N(t);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();Object(l.useEffect)((function(){1===V.role?ce(V):2===V.role&&ie(V.linkedUsers)}),[V]);var oe=Object(l.useState)(!1),ue=Object(u.a)(oe,2),le=ue[0],de=ue[1],je=function(){var e=Object(o.a)(i.a.mark((function e(){var t,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!le){e.next=9;break}return t=document.querySelector(".main-title").innerText,(n=se).style.title=t,e.t0=ce,e.next=7,S(se.id,n);case 7:e.t1=e.sent,(0,e.t0)(e.t1);case 9:de(!le);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),be=Object(l.useState)([]),he=Object(u.a)(be,2),fe=he[0],Oe=he[1];Object(l.useEffect)(Object(o.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(se&&se.username&&se.username.length>0)){e.next=5;break}return e.next=3,O(se.id);case 3:t=e.sent,Oe(t.data);case 5:case"end":return e.stop()}}),e)}))),[se]);var pe=function(e){var t=fe.filter((function(t){return t.id!==e}));Oe(t),m(e)},xe=Object(l.useState)([]),me=Object(u.a)(xe,2),we=me[0],ve=me[1];Object(l.useEffect)(Object(o.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==V.role){e.next=6;break}return e.t0=ve,e.next=4,k();case 4:e.t1=e.sent,(0,e.t0)(e.t1);case 6:case"end":return e.stop()}}),e)}))),[V]);var ge=function(e){var t=we.filter((function(t){return t.id!==e}));ve(t),H(e)},ke=Object(l.useState)(""),ye=Object(u.a)(ke,2),Se=ye[0],He=ye[1],Ne=function(e){return He(e.target.value)},Ce=Object(l.useState)(""),Ie=Object(u.a)(Ce,2),Ae=Ie[0],Te=Ie[1],Ee=function(e){return Te(e.target.value)},Je=function(e){e.preventDefault(),p(function(e,t,n,r,a,s){return{key:s,id:s,description:e,url:t,taken:n,wisher:r,taker:a}}(Se,Ae,0,se.id)).then((function(e){return Oe(fe.concat(e.data))})),console.log("latest wish not for console?",fe),He(""),Te("")},Le=function(e){Oe(fe.map((function(t){return function(t){return t.id!==e||0!==t.taken&&t.taker!==V.id||(t.taken=1-t.taken,t.taker=t.taker?null:V.id,x(e,t)),t}(t)})))},Ue=Object(l.useState)(""),De=Object(u.a)(Ue,2),Fe=De[0],Pe=De[1],We=Object(l.useState)(""),qe=Object(u.a)(We,2),Re=qe[0],Ge=qe[1],Ye=function(e){clearTimeout(Re),Pe(e),Ge(setTimeout((function(){return Pe("")}),1e4))};return Object(r.jsx)(j.a,{children:Object(r.jsxs)(d.d,{children:[Object(r.jsx)(d.b,{path:"/admin",children:!V.username||V.username.length<1?Object(r.jsx)(d.a,{to:"../login"}):2===V.role?Object(r.jsx)(d.a,{to:"../"}):1===V.role?Object(r.jsx)(d.a,{to:"../wisher"}):se&&se.username?Object(r.jsx)(d.a,{to:"../"}):Object(r.jsxs)("div",{children:[P(X),Object(r.jsxs)("table",{className:"the-table",children:[Object(r.jsx)("thead",{children:Object(r.jsxs)("tr",{children:[Object(r.jsx)("th",{children:"User"}),Object(r.jsx)("th",{children:"Delete"}),Object(r.jsx)("th",{children:"Wishes"})]})}),Object(r.jsx)("tbody",{children:we.map((function(e){return function(e,t,n){return Object(r.jsxs)("tr",{className:"untaken-row",children:[Object(r.jsx)("td",{children:e.username}),Object(r.jsx)("td",{children:Object(r.jsx)("button",{onClick:function(){return t(e.id)},children:"delete"})}),1===e.role?Object(r.jsx)("td",{children:Object(r.jsx)("button",{onClick:function(){return n(e.id)},children:"wishes"})}):null]})}(e,ge,ie)}))})]})]})}),Object(r.jsx)(d.b,{path:"/login",children:1===M?V.username&&V.username.length>0?1===V.role?Object(r.jsx)(d.a,{to:"../wisher"}):2===V.role?Object(r.jsx)(d.a,{to:"../"}):0===V.role?Object(r.jsx)(d.a,{to:"../admin"}):void 0:Object(r.jsxs)("div",{children:[Object(r.jsx)("button",{onClick:function(){return Z(0)},children:"Register"}),Object(r.jsx)("h2",{className:"other-title",children:"Login"}),Object(r.jsx)(L,{loginFormAction:ne,usernameHolder:a,usernameHandler:c,passwordHolder:f,passwordHandler:v}),Object(r.jsx)("aside",{className:"instructions",children:"This is the log in page. To create a new user, please, navigate to the registration page on the top left corner."})]}):Object(r.jsxs)("div",{children:[Object(r.jsx)("button",{onClick:function(){return Z(1)},children:"Login"}),Object(r.jsx)("h2",{className:"other-title",children:"Register"}),Object(r.jsx)(J,{loginFormAction:_,usernameHolder:a,usernameHandler:c,passwordHolder:f,passwordHandler:v,inviteHolder:R,inviteHandler:Y}),Object(r.jsx)("aside",{className:"instructions",children:"Here you can register. There are two kinds of users; the ones making the wishes (1) and the ones fulfilling them (2). Let's call them types 1 and 2, respectively. The creation of a type 2 user requires an invite from a type 1 user. If no invite is provided, a user of type 1 is created. "})]})}),Object(r.jsxs)(d.b,{path:"/",children:[!V.username||V.username.length<1?Object(r.jsx)(d.a,{to:"../login"}):0===V.role&&0===Object.keys(se).length?Object(r.jsx)(d.a,{to:"../admin"}):void 0,P(X),function(){var e=Object(r.jsxs)("aside",{className:"instructions",children:['"Generate invite link" creates the invite needed to add type 2 users. To add a user, send her the invite and instruct to provide it at registration. Please, note that all users use the same invite. ',Object(r.jsx)("br",{}),"The form enables adding wishes. All users created using the invite will be able to see the table below but not modify the wishes. They can claim wishes but you won't be shown what is claimed. Also, don't worry about descriptions being too lengthy. They are displayed in full to your type 2 users. Note that you can customise the table header that is displayed to your type 2 users."]}),t=Object(r.jsx)("aside",{className:"instructions",children:"Use the buttons to indicate the wishes you wish to fulfill. Don't worry, this information is not visible to the wisher. You can hover over lenghty descriptions to display them in full."});return 1===V.role?e:2===V.role?t:void 0}(),function(){var e=Object(r.jsxs)("div",{children:[Object(r.jsx)("h2",{className:"other-title",children:"Generate invite link"}),Object(r.jsx)("button",{onClick:function(){return function(e){var t="".concat(e.invitePass,"/").concat(e.id);window.alert("Your invite is ".concat(t))}(V)},children:"Invite"}),Object(r.jsx)(E,{addWish:Je,descriptionHandler:Ne,descriptionHolder:Se,urlHandler:Ee,urlHolder:Ae})]});return 1===V.role?e:null}(),0===V.role?W(ce):null,Object.keys(se).length>0?Object(r.jsxs)("h1",{children:[Object(r.jsx)("span",{className:"main-title",contentEditable:le,children:se.style.title}),1===V.role?q(le,je):null]}):null,Object(r.jsxs)("table",{className:"the-table",children:[Object(r.jsx)("thead",{children:Object(r.jsxs)("tr",{children:[Object(r.jsx)("th",{children:"Wish"}),Object(r.jsx)("th",{children:"URL"}),Object(r.jsx)("th",{children:"Function"})]})}),Object(r.jsx)("tbody",{children:Object(r.jsxs)(d.d,{children:[Object(r.jsx)(d.b,{path:"/wisher",children:fe.map((function(e){return F(e,pe,"delete",Ye,V)}))}),Object(r.jsx)(d.b,{path:"/",children:fe.map((function(e){return F(e,Le,0===e.taken?"take":"untake",Ye,V)}))})]})})]}),Object(r.jsx)(d.d,{children:Object(r.jsx)(d.b,{path:"/",children:Object(r.jsx)(D,{text:Fe})})})]})]})})};s.a.render(Object(r.jsx)(R,{}),document.getElementById("root"))},75:function(e,t){e.exports={info:function(){var e;(e=console).log.apply(e,arguments)},error:function(){var e;(e=console).error.apply(e,arguments)}}}},[[253,1,2]]]);
//# sourceMappingURL=main.8854edbe.chunk.js.map